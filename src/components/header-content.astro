---
import openProjectsBadge from '@/assets/open-projects-badge.svg';
import Availability from '@/components/availability.astro';
import ResumeButton from '@/components/resume-button.astro';
import SvgSprite from '@/components/SvgSprite.astro';
import { SOCIALS } from '@/lib/constants';
import { Image } from 'astro:assets';
---

<div
	class="pointer-events-none flex w-full flex-col justify-between rounded-2xl bg-gray-200 p-5 text-black sm:rounded-3xl sm:p-24 lg:p-20"
>
	<div class="flex items-center justify-between">
		<a
			href="/"
			aria-current="page"
			class="font-sans-serif font-extrabold uppercase leading-none text-3xl"
		>
			<span>shotcowboystyle.</span>
		</a>

		<div
			class="pointer-events-auto grid auto-cols-auto grid-flow-col grid-cols-[auto] grid-rows-[auto] content-center items-center justify-end justify-items-end gap-8"
		>
			<div class="hidden sm:block">
				<Availability />
			</div>

			<a
				href="mailto:curt.blanton@gmail.com"
				rel="noopener noreferrer"
				class="group btn btn-circle btn-neutral relative flex h-20 w-20 items-center justify-center bg-black text-center font-medium !leading-none text-white text-base sm:h-32 sm:w-32 lg:h-24 lg:w-24"
			>
				<span
					id="lets-talk-label"
					class="relative z-[1] normal-case text-white max-sm:!leading-4 max-sm:text-xs sm:!leading-none sm:text-lg"
				>
					Let's<br />Talk
				</span>

				<span
					class="absolute inset-0 z-0 rounded-full bg-black transition-all group-hover:scale-150"
				></span>
			</a>
		</div>
	</div>

	<div class="relative">
		<div class="mb-6 flex items-start max-lg:flex-col lg:mb-16 lg:items-end">
			<div class="relative">
				<h1
					id="header-headline"
					class="reveal mb-2 max-w-[8ch] uppercase !leading-[.9] max-sm:!text-9xl sm:mb-0 sm:max-w-[18ch]"
				>
					Full Stack<br />Senior Developer.
				</h1>

				<div
					id="header-badge"
					class="absolute -top-[20%] right-[-15%] h-24 w-24 scale-0 opacity-0 sm:-right-[15%] sm:-top-[20%] md:h-48 md:w-48 lg:-right-[20%] lg:h-40 lg:w-40"
				>
					<Image
						src={openProjectsBadge}
						alt="Open for new projects"
						widths={[108, 216, openProjectsBadge.width]}
						class="inline-block max-w-full align-middle motion-safe:animate-spin-circle"
					/>
				</div>
			</div>

			<div class="sm:hidden">
				<Availability />
			</div>

			<p
				id="header-intro"
				class="reveal mb-0 mt-4 max-w-[25ch] !leading-5 sm:mb-16 sm:!leading-tight lg:mb-4 lg:ml-auto"
			>
				I help businesses build robust, scalable and engaging experiences through motion and space.
			</p>
		</div>

		<div class="pointer-events-auto relative flex justify-between">
			<div
				class="grid auto-cols-[1fr] grid-flow-row grid-cols-[auto] grid-rows-[auto] items-center gap-y-8 sm:auto-cols-auto sm:grid-flow-col sm:!gap-4"
			>
				<div
					class="header-social-links grid auto-cols-auto grid-flow-col grid-cols-[auto] grid-rows-[auto] items-center justify-start gap-4"
				>
					{
						SOCIALS.map((link) => (
							<a
								aria-label={`Go to my ${link.title} profile`}
								href={link.href}
								target="_blank"
								rel="me noopener noreferrer"
								class="inline-block h-5 w-5 sm:block sm:h-8 sm:w-8 lg:h-5 lg:w-5"
							>
								<div class="h-5 w-5 text-black sm:h-8 sm:w-8 lg:h-5 lg:w-5">
									<SvgSprite
										name={link.title.toLowerCase()}
										class="h-5 w-5 stroke-black sm:h-8 sm:w-8 lg:h-5 lg:w-5"
									/>
								</div>
							</a>
						))
					}
				</div>

				<div class="flex gap-3">
					<a
						class="scroll-link btn btn-neutral btn-sm justify-self-start rounded-full bg-black font-medium text-white hover:scale-110 sm:!min-h-[3rem] sm:justify-self-auto sm:!px-4 lg:!min-h-[2.25rem] lg:!px-4"
						href="#about"
						role="button"
						id="about-button"
					>
						About Me
					</a>

					<ResumeButton />
				</div>
			</div>

			<div class="absolute bottom-0 right-0 h-[5.5rem] w-16">
				<div id="scroll-animation"></div>
			</div>
		</div>
	</div>
</div>

<script>
	import lottie from 'lottie-web';
	import { animate, inView, spring } from 'motion';
	import Splitting from 'splitting';

	window.addEventListener('load', () => {
		const container = document.getElementById('scroll-animation') as HTMLElement;

		lottie.loadAnimation({
			container,
			renderer: 'svg',
			loop: true,
			autoplay: true,
			rendererSettings: {
				progressiveLoad: true,
			},
			path: '/animation/lottie-scroll.json',
		});

		const headerHeadline = document.getElementById('header-headline');
		if (headerHeadline) {
			Splitting({
				target: headerHeadline,
				by: 'words',
				whitespace: true,
			});
		}

		const headerIntro = document.getElementById('header-intro');
		if (headerIntro) {
			Splitting({
				target: headerIntro,
				by: 'words',
				whitespace: true,
			});
		}

		const headerRevealElements = document.querySelectorAll('.reveal');
		[...headerRevealElements].forEach((element) => element.classList.add('animate'));

		const headerBadge = document.getElementById('header-badge')!;
		inView(headerBadge, ({ target }) => {
			animate(
				target,
				{ opacity: 1, transform: 'none' },
				{ delay: 0.5, duration: 0.2, easing: spring() },
			);
		});
	});
</script>

<style>
	.header-social-links {
		grid-area: 2 / 1 / 3 / 2;

		@media screen(md) {
			grid-area: auto;
		}

		svg {
			@apply fill-neutral;
		}
	}

	.header-badge,
	.header-badge > img {
		transform-style: preserve-3d;
	}
</style>
